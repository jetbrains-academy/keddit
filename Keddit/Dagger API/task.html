<html>
<h2>Dagger API</h2>
<p>Here we will implement 4 main annotations Dagger has to provide dependency injection (there are others but they are not covered in this topic)</p>
<ul>
    <li><code>@Modules</code> + <code>@Provides</code>: provides dependencies. A <code>@Provides</code>-annotated method is used to satisfy a dependency requiring a method. This method satisfies a dependency defined by its return type. All <code>@Provides</code>-annotated methods must be included in a module - a class annotated with <code>@Module</code>.</li>
    <li><code>@Inject</code>: request dependencies. <code>@Inject</code> should annotate the constructor used by Dagger while creating instances of a class. Dagger obtains the required parameters values and invokes annotated constructor while creating an instance.</li>
    <li><code>@Component</code>: bridge between modules and injections. The classes annotated with <code>@Inject</code> and <code>@Provides</code> are used to form a graph of objects, which dependencies do link. Code invoking that graph accesses it through roots. This set is defined by an interface with methods returning the needed type and having no arguments. This interface should be annotated as <code>@Component</code>the module types should be passed as module parameters, so Dagger 2 could generate an implementation of that contract.</li>
</ul>
<p>Thanks to default constructors in Kotlin, some dependencies from the constructor were already provided, so you don’t have to change so much your code in the Keddit App in order to provide those.</p>
<h2>@Modules</h2>
<p>3 modules were created:</p>
<ul>
    <li><code>AppModule</code>: provides the <code>Context</code> and the instance to Keddit application.</li>
    <li><code>NetworkModule</code>: provides an instance of Retrofit.</li>
    <li><code>NewsModule</code>: provides the <code>NewsAPI</code> and <code>RedditApi</code> instances.</li>
</ul>
<p>They are all located in the <code>di</code> package.</p>
<p>Also you need to provide is the “<code>NewsManager</code>” but it is not listed in any Module class, this is because you can annotate a constructor of a class that you created with the “<code>@Inject</code>” annotation and Dagger by default will create a <code>Factory</code> and make this class available to be provided like any other “<code>@Provide</code>” in the module classes. Kotlin also allows you to add annotations inlined with the constructor in this way:</p>
<pre><code>@Singleton
class NewsManager @Inject constructor(private val api: NewsAPI) {
    ...
}</code></pre>
<h2>@Inject</h2>
<p>Dependencies are requested in 2 places:</p>
<ul>
    <li><code>NewsManager</code>: as you saw previously in the constructor.</li>
    <li><code>NewsFragment</code>: you need here the <code>NewsManager</code>:</li>
</ul>
<pre><code>@Inject lateinit var newsManager: NewsManager</code></pre>
<blockquote>Remember that ‘<code>lateinit</code>’ allows you to define a non-nullable property and set the value later.</blockquote>
<h2>@Component</h2>
<p>A component called “<code>NewsComponent</code>” was created which will be the bridge between the modules and injections:</p>
<pre><code>@Singleton
@Component(modules = arrayOf(
        AppModule::class,
        NewsModule::class,
        NetworkModule::class)
)
interface NewsComponent {
    fun inject(newsFragment: NewsFragment)
}</code></pre>
<p>At least for now you don’t need to expose any other thing than a method to inject dependencies for the <code>NewsFragment</code>. Dagger will implement this method, search for injectable annotations and provide them.</p>
<h2>Binding Altogether</h2>
<p>Dagger will create a new class called <code>DaggerNewsComponent</code> which will have a builder to create an implementation of our <code>NewsComponent</code> interface. You are going to create an instance of this and make it available from the <code>KedditApp</code> class in a static way:</p>
<pre><code>companion object {
    lateinit var newsComponent: NewsComponent
}
newsComponent = DaggerNewsComponent.builder()
        .appModule(AppModule(this))
        //.newsModule(NewsModule()) NOT REQUIRED
        .build()</code></pre>
<blockquote>Modules with empty constructor are implicitly created by Dagger, so in this case you don’t need to do “<code>.newsModule(…)</code>”, the <code>NewsModule</code> will be created inside the builder for you.</blockquote>
<p>You can use this <code>newsComponent</code> in this way from your <code>NewsFragment</code>:</p>
<pre><code>override fun onCreate(savedInstanceState: Bundle?) {
    super.onCreate(savedInstanceState)
    KedditApp.newsComponent.inject(this)
}</code></pre>
<h2>Task:</h2>
<p>Provide the necessary annotations in the di package (all of the files), <code>NewsFragment.kt</code> and <code>NewsManager.kt</code>.</p>
</html>
<div class='hint'>All of the classes in <code>di</code> package use annotations <code>Provides</code> and <code>Singleton</code> for their methods, except the <code>NewsComponent.kt</code>. <code>NewsComponent</code> uses <code>Singleton</code> and <code>Component</code> in its declaration.</div>
<div class='hint'>In the <code>NewsFragment.kt</code> <code>newsManager</code> variable should be annotated with <code>Inject</code></div>
<div class='hint'>In the <code>NewsManager.kt</code> <code>class</code> should be annotated with <code>Singleton</code> and the constructor should be annotated with <code>Inject</code></div>

<br>
